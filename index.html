<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI News</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; media-src 'self' data: https:; frame-src https://www.youtube.com https://youtube.com; connect-src 'self' https:; font-src 'self' https://cdnjs.cloudflare.com data:;">
  
  <!-- Open Graph meta tags -->
  <meta property="og:title" content="AI News"/>
  <meta property="og:description" content="A fully-automated 3D news show that turns Discord & GitHub chatter into a finished YouTube episode every day."/>
  <meta property="og:image" content="https://elizaos.news/media/15.jpg"/>
  <meta property="og:url" content="https://elizaos.news/"/>
  <meta property="og:type" content="website"/>
  <meta property="og:site_name" content="AI News"/>
  
  <!-- Twitter Card meta tags -->
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="AI News"/>
  <meta name="twitter:description" content="A fully-automated 3D news show that turns Discord & GitHub chatter into a finished YouTube episode every day."/>
  <meta name="twitter:image" content="https://elizaos.news/media/15.jpg"/>
  
  <!-- Additional meta tags -->
  <meta name="description" content="A fully-automated 3D news show that turns Discord & GitHub chatter into a finished YouTube episode every day."/>
  <meta name="keywords" content="AI, news, automated, 3D, YouTube, Discord, GitHub, eliza, ai16z, DAO"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <style>
    :root {
      --lava: #ff4e1b;
      --steel: #18191c;
      --surface: #2d313a;
      --text-primary: #f3f3f3;
      --text-secondary: #bcbcbc;
    }
    .hero-bg {
      transition: opacity 1.2s cubic-bezier(0.4,0,0.2,1);
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      z-index: 0;
    }
    .hero-bg.hidden { opacity: 0; pointer-events: none; }
    .hero-bg.visible { opacity: 1; pointer-events: auto; }
    .hero-darken {
      position: absolute;
      inset: 0;
      width: 100%;
      background: rgba(24, 25, 28, 0.72);
      z-index: 1;
      pointer-events: none;
    }
    body { background: var(--steel); color: var(--text-primary); }
    .lava { background-color: var(--lava) !important; color: var(--steel) !important; }
    .lava-text { color: var(--lava) !important; }
    .steel { background-color: var(--steel) !important; }
    .surface { background-color: var(--surface) !important; }
    .card { background-color: var(--surface) !important; color: var(--text-primary) !important; }
    .card-secondary { color: var(--text-secondary) !important; }
    .nav-link { color: #bcbcbc; transition: color 0.2s; }
    .nav-link:hover { color: #fff; }
    .desc-trunc { max-height: 7.5em; overflow: hidden; position: relative; display: -webkit-box; -webkit-line-clamp: 6; -webkit-box-orient: vertical; }
    .desc-fade { position: absolute; bottom: 0; left: 0; width: 100%; height: 2em; background: linear-gradient(to bottom, rgba(45,49,58,0), var(--surface)); }
  </style>
</head>
<body class="font-sans">
  <!-- Header -->
  <header class="steel">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
      <div class="text-2xl font-bold flex items-center">
        <span class="lava-text">AI</span>
        <span class="ml-1">News</span>
      </div>
      <nav class="space-x-6">
        <a class="nav-link" href="#">Home</a>
        <a class="nav-link" href="#episodes">Episodes</a>
        <a class="nav-link" href="#pipeline">How It Works</a>
        <a class="nav-link" href="https://github.com/elizaOS/eliza" target="_blank">GitHub</a>
        <a class="nav-link" href="https://discord.gg/ai16z" target="_blank">Discord</a>
      </nav>
    </div>
  </header>
  <!-- Hero Section -->
  <section class="relative steel min-h-[60vh] md:min-h-screen flex items-center justify-center overflow-hidden">
    <!-- Fullscreen trailer video as background -->
    <video
      class="absolute inset-0 w-full h-full object-cover z-0"
      src="media/trailer.mp4"
      muted
      autoplay
      loop
      playsinline
      loading="lazy"
      poster="media/trailer_poster.jpg"
      tabindex="-1"
      aria-hidden="true"
    ></video>
    <div class="absolute inset-0 bg-black bg-opacity-60 z-10"></div>
    <!-- Hero content -->
    <div class="container mx-auto px-6 py-24 flex flex-col items-center justify-center text-center relative z-20">
      <h1 class="text-4xl md:text-6xl font-extrabold mb-4 drop-shadow-lg">AI News</h1>
      <p class="text-xl md:text-2xl text-gray-200 mb-6">Bringing You Daily elizaOS Updates</p>
      <p class="text-gray-300 mb-8 max-w-lg">
        A fully-automated 3-D news show that turns Discord &amp; GitHub chatter into a finished YouTube episode every day.
      </p>
      <button
        class="flex items-center justify-center mx-auto w-20 h-20 rounded-full bg-black bg-opacity-60 text-white text-4xl shadow-lg hover:bg-opacity-80 transition"
        aria-label="Play trailer"
        id="hero-trailer-btn"
      >
        ▶
      </button>
      <a href="#episodes" class="inline-block lava font-semibold px-6 py-3 rounded-lg shadow hover:opacity-90 transition mt-8">
        Watch Latest Episode
      </a>
    </div>
  </section>

  <!-- Latest Episodes -->
  <section id="episodes" class="container mx-auto px-6 py-12">
    <h2 class="text-3xl font-bold text-center mb-8 lava-text">Latest Episodes</h2>
    <!-- Language Filter Bar (moved here) -->
    <div class="flex justify-center gap-4 mb-8" id="lang-filter">
      <button data-lang="en" class="lava px-3 py-1 rounded font-semibold text-black">EN</button>
      <button data-lang="ch" class="steel px-3 py-1 rounded font-semibold text-white hover:bg-gray-700">中文</button>
      <button data-lang="ko" class="steel px-3 py-1 rounded font-semibold text-white hover:bg-gray-700">한국어</button>
    </div>
    <div id="episodes-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
    <div id="episodes-pagination" class="flex justify-center items-center gap-2 mt-8"></div>
  </section>

  <!-- Stepper Timeline: How the AI Show Works + Key Innovations (moved below Latest Episodes) -->
  <section class="relative py-24 overflow-hidden" id="pipeline">
    <!-- Slideshow as background -->
    <div id="hero-slideshow" class="absolute inset-0 w-full h-full object-cover -z-10"></div>
    <div class="absolute inset-0 bg-black bg-opacity-70 z-0"></div>
    <div class="container mx-auto px-6 text-center relative z-10">
      <h2 class="text-3xl font-bold lava-text mb-8">How the AI Show Works</h2>
      <ol class="flex flex-col md:flex-row gap-6 md:gap-12 justify-center text-left md:text-center mb-16">
        <li class="relative pl-10 md:pl-0 md:w-40">
          <span class="absolute left-0 top-0 md:relative md:left-auto flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full lava font-bold">1</span>
          <h4 class="font-semibold mt-2 md:mt-4">Data&nbsp;Collection</h4>
          <p class="text-sm text-gray-300">Discord · GitHub · News feeds</p>
        </li>
        <li class="relative pl-10 md:pl-0 md:w-40">
          <span class="absolute left-0 top-0 md:relative md:left-auto flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full lava font-bold">2</span>
          <h4 class="font-semibold mt-2 md:mt-4">Script&nbsp;Generation</h4>
          <p class="text-sm text-gray-300">LLM-powered writing</p>
        </li>
        <li class="relative pl-10 md:pl-0 md:w-40">
          <span class="absolute left-0 top-0 md:relative md:left-auto flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full lava font-bold">3</span>
          <h4 class="font-semibold mt-2 md:mt-4">3D&nbsp;Production</h4>
          <p class="text-sm text-gray-300">Unity animation & effects</p>
        </li>
        <li class="relative pl-10 md:pl-0 md:w-40">
          <span class="absolute left-0 top-0 md:relative md:left-auto flex items-center justify-center w-8 h-8 md:w-10 md:h-10 rounded-full lava font-bold">4</span>
          <h4 class="font-semibold mt-2 md:mt-4">Distribution</h4>
          <p class="text-sm text-gray-300">YouTube & social posting</p>
        </li>
      </ol>
      <div class="grid md:grid-cols-3 gap-6">
        <div class="steel p-6 rounded-lg shadow flex flex-col items-start">
          <i class="fas fa-bolt lava-text text-3xl mb-4"></i>
          <h3 class="text-lg font-bold mb-2">Daily Automated Episodes</h3>
          <p class="text-gray-300 text-sm">
            Fresh data in, new show out – no manual touch-up required.
          </p>
        </div>
        <div class="steel p-6 rounded-lg shadow flex flex-col items-start">
          <i class="fas fa-users lava-text text-3xl mb-4"></i>
          <h3 class="text-lg font-bold mb-2">Dynamic Character Animation</h3>
          <p class="text-gray-300 text-sm">
            Realistic avatars, emotional visemes, and script-driven effects.
          </p>
        </div>
        <div class="steel p-6 rounded-lg shadow flex flex-col items-start">
          <i class="fas fa-tv lava-text text-3xl mb-4"></i>
          <h3 class="text-lg font-bold mb-2">Advanced Media Integration</h3>
          <p class="text-gray-300 text-sm">
            In-game TV, commercial breaks, and seamless media loading.
          </p>
        </div>
      </div>
      <button id="open-bts-modal"
         class="inline-block mt-12 lava px-5 py-2 rounded font-semibold shadow hover:opacity-90">
         Watch the full pipeline demo
      </button>
    </div>
  </section>
  <!-- Footer -->
  <footer class="py-6 bg-white/10 backdrop-blur-md border-t border-white/20">
    <div class="container mx-auto px-6 text-center text-gray-300 text-sm">
      <p>AI News &copy; 2025. Powered by elizaOS & blockchain technology.</p>
      <p>Open source. <a href="https://github.com/elizaOS/eliza" class="lava-text hover:underline" target="_blank">GitHub</a></p>
    </div>
  </footer>
  <!-- Lightbox Modal for Episodes -->
  <div id="lightbox" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
    <!-- Navigation arrows -->
    <button id="prev-episode" class="absolute left-2 md:left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 md:p-3 rounded-full transition-all duration-200 z-10 touch-manipulation">
      <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>
    <button id="next-episode" class="absolute right-2 md:right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 md:p-3 rounded-full transition-all duration-200 z-10 touch-manipulation">
      <svg class="w-5 h-5 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
    
    <div class="surface rounded-lg shadow-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto relative p-4 md:p-6 pr-3 md:pr-4 mx-2 md:mx-0">
      <button id="close-lightbox" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl">&times;</button>
      <div class="flex flex-col gap-6 items-center">
        <!-- Responsive video at the top -->
        <div id="lightbox-video" class="w-full aspect-video relative mb-4">
          <iframe id="lightbox-iframe" class="absolute inset-0 w-full h-full rounded" style="display: none;" allowfullscreen></iframe>
          <div id="video-placeholder" class="bg-gray-800 text-gray-400 flex items-center justify-center h-full rounded">Video unavailable</div>
        </div>
        <!-- Title -->
        <h3 id="lightbox-title" class="text-2xl font-bold mb-1 w-full text-center"></h3>
        <!-- Date and language tabs in a row -->
        <div class="w-full flex flex-col sm:flex-row items-center justify-between mb-3 gap-2 sm:gap-0">
          <p id="lightbox-date" class="card-secondary text-center sm:text-left"></p>
          <div class="flex items-center space-x-3 sm:space-x-4">
            <span id="episode-counter" class="text-xs sm:text-sm text-gray-400 whitespace-nowrap"></span>
            <div class="flex space-x-1 sm:space-x-2" id="lightbox-lang-tabs"></div>
          </div>
        </div>
        <!-- Description full width -->
        <div id="lightbox-description" class="mb-4 w-full"></div>
      </div>
    </div>
  </div>
  <!-- BTS Modal -->
  <div id="bts-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
    <div class="surface rounded-lg shadow-lg w-full max-w-3xl overflow-hidden relative p-0">
      <button id="close-bts-modal" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl z-10">&times;</button>
      <div class="w-full aspect-video bg-black relative">
        <iframe id="bts-iframe" src="" frameborder="0" allowfullscreen class="absolute inset-0 w-full h-full"></iframe>
      </div>
    </div>
  </div>
  <!-- Episodes/Lightbox Script -->
  <script>
    // Hero slideshow logic with gentle crossfade
    const heroImages = Array.from({length: 16}, (_, i) => `media/${i+1}.jpg`);
    let heroIndex = 0;
    let heroTimeout = null;
    const heroSlideshow = document.getElementById('hero-slideshow');
    function setHeroBg(idx) {
      while (heroSlideshow.firstChild) heroSlideshow.removeChild(heroSlideshow.firstChild);
      const img = document.createElement('div');
      img.className = 'hero-bg visible';
      img.style.backgroundImage = `url('${heroImages[idx]}')`;
      img.style.opacity = 1;
      heroSlideshow.appendChild(img);
    }
    function crossfadeHero(nextIdx) {
      const oldImg = heroSlideshow.firstChild;
      const newImg = document.createElement('div');
      newImg.className = 'hero-bg visible';
      newImg.style.backgroundImage = `url('${heroImages[nextIdx]}')`;
      newImg.style.opacity = 0;
      heroSlideshow.appendChild(newImg);
      setTimeout(() => {
        newImg.style.opacity = 1;
        if (oldImg) oldImg.style.opacity = 0;
      }, 10);
      setTimeout(() => {
        if (oldImg && oldImg.parentNode) oldImg.parentNode.removeChild(oldImg);
      }, 1200);
    }
    function startHeroSlideshow() {
      setHeroBg(heroIndex);
      heroTimeout = setInterval(() => {
        const nextIdx = (heroIndex + 1) % heroImages.length;
        crossfadeHero(nextIdx);
        heroIndex = nextIdx;
      }, 4000);
    }
    document.addEventListener('DOMContentLoaded', startHeroSlideshow);

    // Language filter and episode rendering
    let selectedLang = 'en';
    let currentPage = 1;
    const episodesPerPage = 6;

    document.querySelectorAll('#lang-filter button').forEach(btn => {
      btn.addEventListener('click', () => {
        selectedLang = btn.dataset.lang;
        currentPage = 1;
        renderEpisodeCards();
        document.querySelectorAll('#lang-filter button').forEach(b => {
          if (b === btn) {
            b.classList.add('lava');
            b.classList.remove('steel');
            b.classList.add('text-black');
            b.classList.remove('text-white');
          } else {
            b.classList.remove('lava');
            b.classList.add('steel');
            b.classList.remove('text-black');
            b.classList.add('text-white');
          }
        });
      });
    });

    // Fetch episodes.json with simple caching
    let episodesData = null;
    
    // Check if we have cached data (valid for 5 minutes)
    const cachedData = localStorage.getItem('episodesData');
    const cacheTime = localStorage.getItem('episodesDataTime');
    const now = Date.now();
    
    if (cachedData && cacheTime && (now - parseInt(cacheTime)) < 5 * 60 * 1000) {
      episodesData = JSON.parse(cachedData);
      renderEpisodeCards();
    } else {
      fetch('episodes.json')
        .then(r => r.json())
        .then(data => { 
          episodesData = data; 
          localStorage.setItem('episodesData', JSON.stringify(data));
          localStorage.setItem('episodesDataTime', now.toString());
          renderEpisodeCards(); 
        })
        .catch(e => {
          console.error('Failed to load episodes:', e);
          // Fallback to cached data if fetch fails
          if (cachedData) {
            episodesData = JSON.parse(cachedData);
            renderEpisodeCards();
          }
        });
    }

    function renderEpisodeCards() {
      if (!episodesData) return;
      const grid = document.getElementById('episodes-grid');
      grid.innerHTML = '';
      const dates = Object.keys(episodesData).sort((a,b)=>b.localeCompare(a));
      const filteredDates = dates.filter(date => episodesData[date][selectedLang]);
      const totalPages = Math.ceil(filteredDates.length / episodesPerPage);
      const startIdx = (currentPage - 1) * episodesPerPage;
      const endIdx = startIdx + episodesPerPage;
      for (const date of filteredDates.slice(startIdx, endIdx)) {
        const ep = episodesData[date][selectedLang];
        if (!ep) continue;
        const card = document.createElement('div');
        card.className = 'card p-4 rounded-lg shadow-lg flex flex-col cursor-pointer hover:shadow-2xl hover:scale-105 transition-all duration-300';
        card.innerHTML = `
          <div class="relative">
            <img src="${ep.thumbnail || 'media/1.jpg'}" alt="${ep.title}" class="rounded-lg mb-4 w-full h-48 object-cover bg-gray-800" loading="lazy" onerror="this.src='media/1.jpg'"/>
            <span class="absolute top-2 right-2 lava text-xs font-bold px-2 py-1 rounded">${selectedLang.toUpperCase()}</span>
          </div>
          <h3 class="text-lg font-bold line-clamp-2">${ep.title}</h3>
          <p class="text-sm card-secondary">${formatDate(date)}</p>
          <p class="text-sm text-gray-300 mt-2 line-clamp-3">${ep.description ? ep.description.split('\n')[0] : ''}</p>
          <button class="mt-4 lava font-semibold px-4 py-2 rounded hover:opacity-90">Watch Episode</button>
        `;
        card.addEventListener('click', () => openLightbox(date, selectedLang));
        grid.appendChild(card);
      }
      renderEpisodesPagination(totalPages);
    }

    function renderEpisodesPagination(totalPages) {
      const pag = document.getElementById('episodes-pagination');
      pag.innerHTML = '';
      if (totalPages <= 1) return;
      // Previous button
      const prev = document.createElement('button');
      prev.textContent = 'Prev';
      prev.className = 'px-3 py-1 rounded bg-gray-700 text-white font-semibold disabled:opacity-50';
      prev.disabled = currentPage === 1;
      prev.onclick = () => { currentPage--; renderEpisodeCards(); };
      pag.appendChild(prev);
      // Page numbers
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.className = 'px-3 py-1 rounded font-semibold ' + (i === currentPage ? 'lava text-black' : 'bg-gray-700 text-white hover:bg-gray-600');
        btn.onclick = () => { currentPage = i; renderEpisodeCards(); };
        pag.appendChild(btn);
      }
      // Next button
      const next = document.createElement('button');
      next.textContent = 'Next';
      next.className = 'px-3 py-1 rounded bg-gray-700 text-white font-semibold disabled:opacity-50';
      next.disabled = currentPage === totalPages;
      next.onclick = () => { currentPage++; renderEpisodeCards(); };
      pag.appendChild(next);
    }

    // Utility: Format date as "Month DD, YYYY"
    function formatDate(dateStr) {
      const d = new Date(dateStr);
      return d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    // Lightbox logic (unchanged)
    const lightbox = document.getElementById('lightbox');
    const closeBtn = document.getElementById('close-lightbox');
    let currentDate = null, currentLang = null;
    function openLightbox(date, lang) {
      currentDate = date;
      currentLang = lang;
      const ep = episodesData[date][lang];
      document.getElementById('lightbox-title').textContent = ep.title;
      document.getElementById('lightbox-date').textContent = formatDate(date);
      // Description logic
      const descDiv = document.getElementById('lightbox-description');
      let desc = ep.description || '';
      desc = desc.replace(/\\n/g, '\n');
      desc = desc.replace(/\r/g, '');
      let expanded = false;
      function renderDesc() {
        descDiv.innerHTML = '';
        if (!desc) return;
        if (!expanded && desc.length > 300) {
          let trunc = desc.slice(0, 300);
          const paraEnd = desc.indexOf('\n\n');
          if (paraEnd > 0 && paraEnd < 300) trunc = desc.slice(0, paraEnd);
          const p = document.createElement('div');
          p.className = 'desc-trunc relative';
          p.innerHTML = trunc.replace(/\n/g, ' ');
          const fade = document.createElement('div');
          fade.className = 'desc-fade';
          p.appendChild(fade);
          descDiv.appendChild(p);
          const more = document.createElement('a');
          more.href = '#';
          more.className = 'lava-text font-semibold ml-2';
          more.textContent = 'Read more';
          more.onclick = function(e) { e.preventDefault(); expanded = true; renderDesc(); };
          descDiv.appendChild(more);
        } else if (!expanded) {
          descDiv.textContent = desc.replace(/\n/g, ' ');
        } else {
          const full = document.createElement('div');
          full.innerHTML = desc.replace(/\n/g, '<br>');
          descDiv.appendChild(full);
          const less = document.createElement('a');
          less.href = '#';
          less.className = 'lava-text font-semibold ml-2';
          less.textContent = 'Show less';
          less.onclick = function(e) { e.preventDefault(); expanded = false; renderDesc(); };
          descDiv.appendChild(less);
        }
      }
      renderDesc();
      const tabs = document.getElementById('lightbox-lang-tabs');
      tabs.innerHTML = '';
      for (const l of ['en', 'ch', 'ko']) {
        if (!episodesData[date][l]) continue;
        const btn = document.createElement('button');
        btn.textContent = l.toUpperCase();
        btn.className = 'px-2 py-1 rounded font-bold ' + (l === lang ? 'lava' : 'bg-gray-700 text-gray-200 hover:bg-gray-600');
        btn.addEventListener('click', e => {
          e.stopPropagation();
          openLightbox(date, l);
        });
        tabs.appendChild(btn);
      }
      const iframe = document.getElementById('lightbox-iframe');
      const placeholder = document.getElementById('video-placeholder');
      
      if (ep.url && ep.id) {
        // Set up the iframe with the video
        iframe.src = `https://www.youtube.com/embed/${ep.id}?autoplay=1&rel=0&modestbranding=1`;
        iframe.title = ep.title;
        iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
        
        // Show iframe, hide placeholder
        iframe.style.display = 'block';
        placeholder.style.display = 'none';
      } else {
        // Show placeholder, hide iframe
        iframe.style.display = 'none';
        placeholder.style.display = 'flex';
        placeholder.textContent = 'Video unavailable';
      }
      lightbox.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
      
      // Update navigation arrows
      updateNavigationArrows();
    }
    
    // Event listeners for navigation arrows
    document.getElementById('prev-episode').addEventListener('click', function(e) {
      e.stopPropagation();
      e.preventDefault();
      navigateToPreviousEpisode();
    });
    
    document.getElementById('next-episode').addEventListener('click', function(e) {
      e.stopPropagation();
      e.preventDefault();
      navigateToNextEpisode();
    });
    
    // Add touch event listeners for better mobile experience
    document.getElementById('prev-episode').addEventListener('touchstart', function(e) {
      e.stopPropagation();
    });
    
    document.getElementById('next-episode').addEventListener('touchstart', function(e) {
      e.stopPropagation();
    });
    
    if (closeBtn) closeBtn.addEventListener('click', closeLightbox);
    if (lightbox) lightbox.addEventListener('mousedown', e => {
      if (e.target === lightbox) { closeLightbox(); }
    });

    // BTS Modal logic
    const btsModal = document.getElementById('bts-modal');
    const openBtsBtn = document.getElementById('open-bts-modal');
    const closeBtsBtn = document.getElementById('close-bts-modal');
    const btsIframe = document.getElementById('bts-iframe');
    openBtsBtn.addEventListener('click', () => {
      btsModal.classList.remove('hidden');
      btsIframe.src = 'https://www.youtube.com/embed/fIGoyaEd0Hw';
      document.body.classList.add('overflow-hidden');
    });
    closeBtsBtn.addEventListener('click', closeTrailerModal);
    btsModal.addEventListener('mousedown', e => {
      if (e.target === btsModal) {
        closeTrailerModal();
      }
    });

    function openHeroTrailerModal() {
      const btsModal = document.getElementById('bts-modal');
      const btsIframe = document.getElementById('bts-iframe');
      btsModal.classList.remove('hidden');
      btsIframe.src = 'https://www.youtube.com/embed/62OoNMf10nA?autoplay=1&rel=0&modestbranding=1';
      document.body.classList.add('overflow-hidden');
    }

    // Add event listener for hero trailer button
    document.addEventListener('DOMContentLoaded', function() {
      const heroTrailerBtn = document.getElementById('hero-trailer-btn');
      if (heroTrailerBtn) {
        heroTrailerBtn.addEventListener('click', openHeroTrailerModal);
      }
    });

    // Keyboard navigation for episodes
    document.addEventListener('keydown', function(e) {
      // Only handle keyboard navigation when lightbox is open
      if (!lightbox.classList.contains('hidden')) {
        if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
          e.preventDefault();
          navigateToPreviousEpisode();
        } else if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
          e.preventDefault();
          navigateToNextEpisode();
        } else if (e.key === 'Escape') {
          e.preventDefault();
          closeLightbox();
        }
      }
      // Handle ESC for trailer modal too
      if (!btsModal.classList.contains('hidden') && e.key === 'Escape') {
        e.preventDefault();
        closeTrailerModal();
      }
    });

    // Episode navigation functions
    function navigateToPreviousEpisode() {
      if (!episodesData || !currentDate) return;
      const dates = Object.keys(episodesData).sort((a,b)=>b.localeCompare(a));
      const currentIndex = dates.indexOf(currentDate);
      if (currentIndex < dates.length - 1) {
        const prevDate = dates[currentIndex + 1];
        openLightbox(prevDate, selectedLang);
      }
    }

    function navigateToNextEpisode() {
      if (!episodesData || !currentDate) return;
      const dates = Object.keys(episodesData).sort((a,b)=>b.localeCompare(a));
      const currentIndex = dates.indexOf(currentDate);
      if (currentIndex > 0) {
        const nextDate = dates[currentIndex - 1];
        openLightbox(nextDate, selectedLang);
      }
    }

    function updateNavigationArrows() {
      if (!episodesData || !currentDate) return;
      
      const dates = Object.keys(episodesData).sort((a,b)=>b.localeCompare(a));
      const currentIndex = dates.indexOf(currentDate);
      
      const prevBtn = document.getElementById('prev-episode');
      const nextBtn = document.getElementById('next-episode');
      const counter = document.getElementById('episode-counter');
      
      // Update episode counter (1-indexed for users)
      counter.textContent = `${currentIndex + 1} of ${dates.length}`;
      
      // Show/hide and enable/disable based on position
      if (currentIndex >= dates.length - 1) {
        prevBtn.style.opacity = '0.3';
        prevBtn.style.cursor = 'not-allowed';
      } else {
        prevBtn.style.opacity = '1';
        prevBtn.style.cursor = 'pointer';
      }
      
      if (currentIndex <= 0) {
        nextBtn.style.opacity = '0.3';
        nextBtn.style.cursor = 'not-allowed';
      } else {
        nextBtn.style.opacity = '1';
        nextBtn.style.cursor = 'pointer';
      }
    }

    function closeLightbox() {
      lightbox.classList.add('hidden'); 
      document.body.classList.remove('overflow-hidden');
      
      // Stop video playback and reset iframe
      const iframe = document.getElementById('lightbox-iframe');
      const placeholder = document.getElementById('video-placeholder');
      
      iframe.src = '';
      iframe.style.display = 'none';
      placeholder.style.display = 'flex';
      placeholder.textContent = 'Video unavailable';
    }

    function closeTrailerModal() {
      btsModal.classList.add('hidden');
      btsIframe.src = '';
      document.body.classList.remove('overflow-hidden');
    }
  </script>

</body>
</html> 
